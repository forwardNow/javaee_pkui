<form class="da-form"
      action="__CTX__/admin/sysMenuUpdate" method="post"
      data-pkui-component="validator|form"
      data-done-callback="editSysMenuDoneCallback"
      data-fail-callback="editSysMenuFailCallback"
      data-always-callback="editSysMenuAlwaysCallback" >

    <input type="hidden" name="menuId" value="{{menuId}}">
    <input type="hidden" name="treeLevel" value="{{treeLevel}}">
    <input type="hidden" name="treeParentid" value="{{treeParentid}}">

    <div class="da-form-heading">{{menuName}}</div>
    <div class="da-form-body">
        <table class="da-form-table da-table da-table-striped">
            <colgroup>
                <col width="20%">
                <col width="80%">
            </colgroup>
            <tr>
                <td class="text-right"><label class="da-control-label required">菜单名称：</label></td>
                <td><input type="text" class="da-form-control" name="menuName" value="{{menuName}}"
                           data-rule='“菜单名称”: required'></td>
            </tr>
            <tr>
                <td class="text-right"><label class="da-control-label required">链接路径：</label></td>
                <td><input type="text" class="da-form-control" name="menuUrl" value="{{menuUrl}}"
                           data-rule='“链接路径”: required'></td>
            </tr>
            <tr>
                <td class="text-right"><label class="da-control-label required">是否可用：</label></td>
                <td>
                    <div class="da-form-radio">
                        <label><input type="radio" name="visiable" value="1" {{if visiable === "1"}}checked{{/if}}>是</label>
                        <label><input type="radio" name="visiable" value="0" {{if visiable === "0"}}checked{{/if}}>否</label>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="text-right"><label class="da-control-label required">是否展开：</label></td>
                <td>
                    <div class="da-form-radio">
                        <label><input type="radio" name="expand" value="1" {{if visiable === "1"}}checked{{/if}}>是</label>
                        <label><input type="radio" name="expand" value="0" {{if visiable === "0"}}checked{{/if}}>否</label>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="text-right"><label class="da-control-label">备注：</label></td>
                <td><input type="text" class="da-form-control" name="memo" value="{{memo}}"></td>
            </tr>
            <tr>
                <td class="text-right"><label class="da-control-label">图标：</label></td>
                <!--
                <td><input type="text" class="da-form-control" name="icon" value="{{icon}}"
                           style="width: 60%; margin-right: 20px;">{{icon | iconFormat: "24px"}}</td>
                -->
                <style>
                    .icon-container {
                        padding: 6px 0;
                    }
                    .icon-edit {
                        position: relative;
                        float: left;
                        width: 40%;
                        min-width: 200px;
                        padding-right: 12px;
                        border-right: dashed 1px #ccc;
                    }
                    .icon-edit-display {
                        width: 100px;
                        height: 100px;
                        border: solid 1px #ccc;
                        line-height: 100px;
                        text-align: center;
                        background-color: #fff;
                    }
                    .icon-edit-display .fa {
                        font-size: 32px;
                    }
                    .icon-edit-input {
                        padding-top: 6px;
                    }
                    .icon-custom {
                        float: left;
                        width: 50%;
                        min-width: 242px;
                        /*height: 136px;*/
                    }
                    .icon-custom-btn {
                        margin: 46px 0 0 40px;;
                    }
                    .icon-edit-tool {
                        position: absolute;
                        top: 0;
                        right: 12px;
                    }
                    .icon-help,
                    .icon-more {
                        float: left;
                    }
                    .icon-help {
                        margin-left: .5em;
                    }
                    .icon-custom-choose {
                        width: 240px;
                        height: 240px;
                        border: solid 1px #ccc;
                        background-color: #fff;
                    }
                    .icon-custom-upload {

                    }
                    .icon-custom-upload-display {
                        display: inline-block;
                        width: 26px;
                        height: 26px;
                        border: solid 1px #ccc;
                    }
                </style>
                <td>
                    <div class="icon-container clearfix">
                        <div class="icon-edit">
                            <div class="icon-edit-display" id="iconDisplayArea">
                                {{if icon}}
                                    {{icon | iconFormat: "24px"}}
                                {{else}}
                                    <i class="fa fa-question"></i>
                                {{/if}}
                            </div>
                            <div class="icon-edit-input">
                                <input type="text" class="da-form-control" name="icon" id="sysMenuIconInput" value="{{icon}}">
                            </div>
                            <div class="icon-edit-tool">
                                <a class="icon-more"
                                   title="查看更多可选图标"
                                   href="__CTX__/static/pkui/css/font/font-awesome/4.7.0/index.html"
                                   target="fa_demo_window"><i class="fa fa-external-link-square"></i> 更多</a>
                                <a class="icon-help"
                                   title="方式一：点击“更多”，在新页面中拷贝合适的图标名称，粘贴到输入框。方式二：点击“使用自定义图标”按钮，在图标区域选取合适的图标。"
                                   href="javascript:void(0)"><i class="fa fa-question-circle-o"></i> 帮助</a>
                            </div>
                        </div>
                        <div class="icon-custom clearfix">
                            <button type="button" class="btn btn-info icon-custom-btn hidden"><i class="fa fa-folder-open-o"></i> 使用自定义图标</button>
                            <div class="icon-custom-choose"></div>
                            <div class="icon-custom-upload">
                                <button type="button" class="btn btn-success-2 icon-custom-upload-btn"><i class="fa fa-upload"></i> 上传</button>
                                <div class="icon-custom-upload-display"></div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <div class="da-form-footer">
        <button type="submit" class="btn btn-success-2">确定</button>
    </div>
</form>


<script>
    // 请求发送成功，对服务器端返回的数据进行处理
    function editSysMenuDoneCallback($form, jsonResult) {
        console.info( jsonResult );
        jsonResult = window.PKUI.handleJsonResult( jsonResult );
        console.info( jsonResult );
        // 服务器端处理成功
        if ( jsonResult.success ) {
            // 提示
            layer.alert( '修改成功！', { icon: 1 }, function ( index ) {
                layer.close( index );
                // 关闭抽屉层
                $form.closest( ".pkui-drawer" ).find( ".pkui-drawer-button" ).trigger( "click" );
                // 刷新菜单
                $( "#refreshSysMenuTreeButton" ).trigger( "click" );
            } );
        }
        // 服务器端处理失败
        else {
            // 提示
            layer.alert( '修改失败！', { icon: 2 } );
        }
    }

    // 请求发送失败
    function editSysMenuFailCallback($form) {
        // 提示网络错误
        layer.alert( '网络错误！', { icon: 0 } );
    }

    // 无论请求发送成功与否
    function editSysMenuAlwaysCallback($form) {
        // 无论
    }
    +function () {
        var
            $ = jQuery,
            $sysMenuIconInput = $( "#sysMenuIconInput" ),
            $iconDisplayArea = $( "#iconDisplayArea" )
        ;
        $sysMenuIconInput.off( "input" ).on( "input", function () {
            var
                value = this.value,
                url,
                style
            ;
            if ( !value ) {
                return;
            }
            if ( value.indexOf( "fa-" ) !== -1 ) {
                $iconDisplayArea.html( '<i class="' + value + '"></i>' );
                return;
            }
            if ( value.indexOf( ".png" ) != -1 ) {
                url = window.PKUI.iconBasePath + "/24x24/" + value;
                style = "background-image: url(" + url + "); width: 100%; height: 100%;";
                $iconDisplayArea.html( '<span class="pkui-icon-image" style="' + style + '"></span>' )
            }

        } );
    } ();
</script>